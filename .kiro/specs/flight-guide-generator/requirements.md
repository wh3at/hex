# Requirements Document

## はじめに
フライトパーキングは羽田空港のバレーパーキングサービスであり、顧客の出発前日に搭乗口案内画像を送付しています。
このプロセスを自動化するため、便名を入力として搭乗口情報を取得し、ターミナル画像と合成して案内画像を生成する機能を開発します。
このツールにより、スタッフの作業時間を削減し、案内画像の品質を一定に保つことができます。

## 要件

### 要件1: 便名入力と検証
**ユーザーストーリー:** フライトパーキングのスタッフとして、複数の便名を効率的に入力して搭乗口情報を取得したい。これにより、複数の顧客の案内画像を一度に生成できる。

#### 受け入れ基準
1. WHEN ユーザーが便名を入力する THEN システムは便名の形式（例：JL123、NH456）を検証SHALL
2. WHEN ユーザーが複数の便名をスペース区切りで入力する THEN システムは各便名を個別に検証SHALL
3. IF 便名の形式が不正 THEN システムは適切なエラーメッセージを表示SHALL
4. WHEN 有効な便名が入力される THEN システムは航空会社を自動識別SHALL
5. WHEN バッチ入力時 THEN システムはJAL/ANAの便名のみを処理対象としてフィルタリングSHALL
6. IF バッチ入力で一部の便名が無効 THEN システムは有効な便名のみ処理を続行し、無効な便名をリスト表示SHALL

### 要件2: 搭乗口情報の取得
**ユーザーストーリー:** フライトパーキングのスタッフとして、JAL・ANA便の航空会社公式サイトから最新の搭乗口情報を自動取得したい。これにより、手動検索の時間を削減できる。

#### 受け入れ基準
1. WHEN JAL（JL）またはANA（NH）の有効な便名が提供される THEN システムは該当航空会社の公式サイトにアクセスSHALL
2. WHILE ページが読み込まれている THE SYSTEM SHALL 進捗状況を表示
3. IF 搭乗口情報が見つかる THEN システムは搭乗口番号と関連情報を抽出SHALL
4. IF 搭乗口情報が未定または見つからない THEN システムは「搭乗口未定」として処理SHALL
5. WHEN ネットワークエラーが発生する THEN システムは3回までリトライSHALL
6. IF すべてのリトライが失敗 THEN システムは詳細なエラー情報を提供SHALL

### 要件3: スクリーンショット撮影
**ユーザーストーリー:** フライトパーキングのスタッフとして、搭乗口情報の証跡となるスクリーンショットを自動撮影したい。これにより、顧客への正確な情報提供が可能になる。

#### 受け入れ基準
1. WHEN 搭乗口情報ページが表示される THEN システムは搭乗口情報部分のスクリーンショットを撮影SHALL
2. WHERE スクリーンショットを撮影する際 THE SYSTEM SHALL 搭乗口番号が明確に見える範囲を選択
3. IF ページレイアウトが想定と異なる THEN システムは全画面スクリーンショットを代替として保存SHALL
4. WHEN スクリーンショットが撮影される THEN システムは画像を一時保存SHALL
5. IF スクリーンショット撮影が失敗 THEN システムは再試行オプションを提供SHALL

### 要件4: ターミナル画像との合成
**ユーザーストーリー:** フライトパーキングのスタッフとして、取得した搭乗口情報とターミナル画像を自動合成したい。これにより、顧客にとって分かりやすい案内画像を作成できる。

#### 受け入れ基準
1. WHEN 搭乗口情報が取得される THEN システムは対応するターミナル（第1/第2/第3）を判定SHALL
2. IF ターミナルが特定される THEN システムは該当ターミナルのテンプレート画像を選択SHALL
3. WHEN 画像合成を実行する THEN システムは搭乗口位置をターミナル画像上にマーキングSHALL
4. WHERE 搭乗口情報を表示する際 THE SYSTEM SHALL テキストオーバーレイで便名、搭乗口番号、出発時刻を追加
5. IF 合成処理中にエラーが発生 THEN システムは元画像を保持し、エラー詳細を報告SHALL

### 要件5: 出力ファイル管理
**ユーザーストーリー:** フライトパーキングのスタッフとして、生成された案内画像を適切に保存・管理したい。これにより、顧客への送付作業が効率化される。

#### 受け入れ基準
1. WHEN 案内画像が生成される THEN システムは「日付/便名_時刻.png」形式でフォルダ名とファイル名を設定SHALL
2. WHERE 画像を保存する際 THE SYSTEM SHALL 設定された出力ディレクトリに保存
3. IF 同名ファイルが存在する THEN システムは上書き確認を求めるSHALL
4. IF 保存に失敗 THEN システムは代替保存先の選択オプションを提供SHALL

### 要件6: 設定とカスタマイズ
**ユーザーストーリー:** フライトパーキングのスタッフとして、ターミナル画像や出力設定をカスタマイズしたい。これにより、サービスの変更に柔軟に対応できる。

#### 受け入れ基準
1. WHEN 初回起動時 THEN システムはデフォルト設定ファイルを作成SHALL
2. WHERE 設定ファイル内で THE SYSTEM SHALL ターミナル画像パス、出力ディレクトリ、画像品質を設定可能
3. IF カスタムターミナル画像が指定される THEN システムは画像の妥当性を検証SHALL
4. WHEN 設定が変更される THEN システムは変更内容を即座に反映SHALL
5. IF 設定ファイルが破損 THEN システムはデフォルト設定で動作SHALL

### 要件7: エラーハンドリングとロギング
**ユーザーストーリー:** フライトパーキングのスタッフとして、エラー発生時に適切な対処ができるよう詳細な情報が欲しい。これにより、問題解決が迅速に行える。

#### 受け入れ基準
1. WHILE プログラムが実行中 THE SYSTEM SHALL すべての重要な操作をログに記録
2. WHEN エラーが発生する THEN システムはユーザーフレンドリーなエラーメッセージを表示SHALL
3. WHERE エラーログを保存する際 THE SYSTEM SHALL タイムスタンプ付きでログファイルに記録
4. IF 致命的エラーが発生 THEN システムは部分的な結果を保存してから終了SHALL
5. WHEN デバッグモードが有効 THEN システムは詳細なデバッグ情報を出力SHALL

### 要件8: パフォーマンスと信頼性
**ユーザーストーリー:** フライトパーキングのスタッフとして、迅速かつ確実に案内画像を生成したい。これにより、業務効率が向上する。

#### 受け入れ基準
1. WHEN 通常の処理を実行する THEN システムは30秒以内に完了SHALL
2. IF 処理が30秒を超える THEN システムは進捗状況と推定残り時間を表示SHALL
3. WHERE ブラウザ自動化を使用する際 THE SYSTEM SHALL ヘッドレスモードで動作
4. WHEN 複数の便名を処理する場合 THEN システムはバッチ処理機能を提供SHALL
5. IF メモリ使用量が閾値を超える THEN システムはリソースをクリーンアップSHALL

### 要件9: ユーザーインターフェース
**ユーザーストーリー:** フライトパーキングのスタッフとして、直感的で使いやすいコマンドラインインターフェースが欲しい。これにより、トレーニング時間を削減できる。

#### 受け入れ基準
1. WHEN コマンドを実行する THEN システムは明確な使用方法を表示SHALL
2. WHERE ヘルプを表示する際 THE SYSTEM SHALL 各オプションの詳細説明を含める
3. IF 無効なオプションが指定される THEN システムは正しい使用例を提示SHALL
4. WHEN 処理が進行中 THEN システムはプログレスバーまたはスピナーを表示SHALL
5. WHERE 確認が必要な場合 THE SYSTEM SHALL インタラクティブなプロンプトを表示

### 要件10: 対応航空会社
**ユーザーストーリー:** フライトパーキングのスタッフとして、JAL・ANAの国内線について搭乗口案内画像を自動生成したい。これにより、主要な顧客層にサービスを提供できる。

#### 受け入れ基準
1. WHERE 便名を処理する際 THE SYSTEM SHALL JAL（JL）とANA（NH）の国内線のみ搭乗口検索と画像生成を実行
2. IF JAL/ANA以外の航空会社の便名 THEN システムは「搭乗口固定のためスキップ」メッセージを表示SHALL
3. WHEN 処理結果を表示する際 THE SYSTEM SHALL 処理済み（JAL/ANA）とスキップ（その他）を区別して表示
4. WHERE 羽田空港の搭乗口固定航空会社（スカイマーク、ピーチ、ジェットスター等） THE SYSTEM SHALL 自動的に処理をスキップ
5. IF 将来的にJAL/ANA以外の対応が必要 THEN システムは設定ファイルで拡張可能SHALL